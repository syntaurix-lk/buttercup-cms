services:
  api:
    build:
      context: .
      target: production
    container_name: buttercup-api
    restart: unless-stopped

    # Loads all variables from your production .env
    env_file:
      - .env

    # Expose API
    ports:
      - "8000:8000"

    # Persist uploads + logs across deploys
    volumes:
      - ./uploads:/app/uploads
      - ./logs:/app/logs

    # Run DB migrations, then start the API
    command: >
      sh -c "alembic upgrade head &&
             uvicorn main:app --host 0.0.0.0 --port 8000"
